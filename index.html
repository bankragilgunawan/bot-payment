<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Payment - ChatBot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 500px;
            height: 80vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .chat-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .chat-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            background: #f1f5f9;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 5px;
            opacity: 0.8;
        }

        .bot-message .message-time {
            color: #64748b;
        }

        .user-message .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .input-container {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        textarea {
            flex: 1;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            padding: 12px 20px;
            resize: none;
            outline: none;
            transition: border-color 0.3s;
            font-size: 1rem;
            min-height: 50px;
            max-height: 100px;
        }

        textarea:focus {
            border-color: #4facfe;
        }

        button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 12px 16px;
            background: #f1f5f9;
            border-radius: 18px;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: bounce 1.5s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-text {
            text-align: center;
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 10px;
        }

        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .bot-avatar {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
            font-size: 0.8rem;
        }

        .user-avatar {
            background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            color: white;
            font-size: 0.8rem;
        }

        .message-with-avatar {
            display: flex;
            align-items: flex-end;
        }

        .bot-message-with-avatar {
            align-self: flex-start;
        }

        .user-message-with-avatar {
            align-self: flex-end;
        }

        .user-message-with-avatar .message-content {
            flex-direction: row-reverse;
        }

        .user-message-with-avatar .avatar {
            margin-right: 0;
            margin-left: 10px;
        }

        .message-content {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        .service-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .category-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s;
            text-align: center;
        }

        .category-button:hover {
            transform: scale(1.05);
        }

        .service-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .service-button {
            background: #e2e8f0;
            color: #334155;
            border: none;
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .service-button:hover {
            background: #cbd5e1;
        }

        .form-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #334155;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #4facfe;
        }

        .submit-form {
            background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-form:hover {
            transform: scale(1.02);
        }

        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply {
            background: #e2e8f0;
            color: #334155;
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-reply:hover {
            background: #cbd5e1;
        }

        .rating-container {
            text-align: center;
            margin: 15px 0;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }

        .star {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.active {
            color: #ffc107;
        }

        .payment-button {
            background: linear-gradient(135deg, #ff9a00 0%, #ff6a00 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .payment-button:hover {
            transform: scale(1.02);
        }

        /* Audio elements - hidden */
        audio {
            display: none;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1><i class="fas fa-robot"></i> Bot Payment</h1>
            <p>Layanan Pulsa, Transfer, PPOB & Lainnya</p>
        </div>
        
        <div class="messages-container" id="messagesContainer">
            <div class="message-with-avatar bot-message-with-avatar">
                <div class="message-content">
                    <div class="avatar bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message bot-message">
                        <div>Halo! Selamat datang di Bot Payment. Sebelum menggunakan layanan, mohon berikan nomor WhatsApp Anda untuk kemudahan komunikasi.</div>
                        <div class="message-time" id="initial-time"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="input-container">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    placeholder="Masukkan nomor WhatsApp Anda..." 
                    rows="1"
                ></textarea>
                <button id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="info-text">
                Kami akan menghubungi Anda melalui WhatsApp
            </div>
        </div>
    </div>

    <!-- Audio elements for sound effects -->
    <audio id="sendSound" preload="auto">
        <source src="notif/kirim.mp3" type="audio/mpeg">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3" type="audio/mpeg">
    </audio>
    <audio id="receiveSound" preload="auto">
        <source src="notif/terima.mp3" type="audio/mpeg">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Format waktu
        function formatTime(date) {
            return date.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Set waktu awal
        document.getElementById('initial-time').textContent = formatTime(new Date());

        // Referensi elemen
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const sendSound = document.getElementById('sendSound');
        const receiveSound = document.getElementById('receiveSound');

        // Variabel global
        let userPhoneNumber = '';
        let cart = [];
        let currentStep = 'ask_phone'; // ask_phone, main_menu, service_menu, form, checkout, rating, payment

        // Fungsi untuk memainkan suara kirim
        function playSendSound() {
            try {
                sendSound.currentTime = 0;
                sendSound.play().catch(e => console.log("Audio play error:", e));
            } catch (e) {
                console.log("Cannot play send sound");
            }
        }

        // Fungsi untuk memainkan suara terima
        function playReceiveSound() {
            try {
                receiveSound.currentTime = 0;
                receiveSound.play().catch(e => console.log("Audio play error:", e));
            } catch (e) {
                console.log("Cannot play receive sound");
            }
        }

        // Fungsi untuk menambahkan pesan ke chat dengan jeda
        function addMessageWithDelay(text, isUser = false, delay = 1000) {
            return new Promise(resolve => {
                // Tampilkan indikator mengetik
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'typing-indicator';
                typingIndicator.id = 'typing-indicator';
                typingIndicator.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                messagesContainer.appendChild(typingIndicator);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Setelah jeda, tampilkan pesan
                setTimeout(() => {
                    // Hapus indikator mengetik
                    if (document.getElementById('typing-indicator')) {
                        document.getElementById('typing-indicator').remove();
                    }

                    // Tambahkan pesan
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message-with-avatar ${isUser ? 'user-message-with-avatar' : 'bot-message-with-avatar'}`;
                    
                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';
                    
                    if (!isUser) {
                        const avatar = document.createElement('div');
                        avatar.className = `avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`;
                        avatar.innerHTML = `<i class="fas ${isUser ? 'fa-user' : 'fa-robot'}"></i>`;
                        
                        const messageBubble = document.createElement('div');
                        messageBubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                        messageBubble.innerHTML = `
                            <div>${text}</div>
                            <div class="message-time">${formatTime(new Date())}</div>
                        `;
                        
                        messageContent.appendChild(avatar);
                        messageContent.appendChild(messageBubble);
                    } else {
                        const avatar = document.createElement('div');
                        avatar.className = `avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`;
                        avatar.innerHTML = `<i class="fas ${isUser ? 'fa-user' : 'fa-robot'}"></i>`;
                        
                        const messageBubble = document.createElement('div');
                        messageBubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                        messageBubble.innerHTML = `
                            <div>${text}</div>
                            <div class="message-time">${formatTime(new Date())}</div>
                        `;
                        
                        messageContent.appendChild(avatar);
                        messageContent.appendChild(messageBubble);
                    }
                    
                    messageDiv.appendChild(messageContent);
                    messagesContainer.appendChild(messageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    
                    // Mainkan suara terima untuk pesan bot
                    if (!isUser) {
                        playReceiveSound();
                    }
                    
                    resolve();
                }, delay);
            });
        }

        // Fungsi untuk menambahkan pesan user (tanpa jeda)
        function addMessage(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-with-avatar ${isUser ? 'user-message-with-avatar' : 'bot-message-with-avatar'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            if (isUser) {
                const avatar = document.createElement('div');
                avatar.className = `avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`;
                avatar.innerHTML = `<i class="fas ${isUser ? 'fa-user' : 'fa-robot'}"></i>`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                messageBubble.innerHTML = `
                    <div>${text}</div>
                    <div class="message-time">${formatTime(new Date())}</div>
                `;
                
                messageContent.appendChild(avatar);
                messageContent.appendChild(messageBubble);
            }
            
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Mainkan suara kirim untuk pesan user
            if (isUser) {
                playSendSound();
            }
        }

        // Validasi nomor WhatsApp
        function isValidPhoneNumber(phone) {
            const phoneRegex = /^(\+62|62|0)8[1-9][0-9]{6,10}$/;
            return phoneRegex.test(phone);
        }

        // Menampilkan menu utama
        function showMainMenu() {
            currentStep = 'main_menu';
            messageInput.placeholder = "Ketik pesan Anda atau pilih kategori...";
            
            setTimeout(async () => {
                const menuHtml = `
                    <div class="service-categories">
                        <button class="category-button" onclick="showAllServices()">Semua Layanan</button>
                        <button class="category-button" onclick="showPulsaMenu()">Pulsa</button>
                        <button class="category-button" onclick="showTransferMenu()">Transfer</button>
                        <button class="category-button" onclick="showPPOBMenu()">PPOB</button>
                    </div>
                `;
                
                await addMessageWithDelay("Berikut layanan yang tersedia:");
                showMenuMessage(menuHtml);
            }, 500);
        }

        // Menampilkan pesan menu
        function showMenuMessage(menuHtml) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-with-avatar bot-message-with-avatar';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="avatar bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message bot-message">
                        ${menuHtml}
                        <div class="message-time">${formatTime(new Date())}</div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            playReceiveSound();
        }

        // Menampilkan semua layanan
        function showAllServices() {
            currentStep = 'service_menu';
            
            setTimeout(async () => {
                const services = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showPulsaForm()">Pulsa Reguler</button>
                        <button class="service-button" onclick="showDataForm()">Paket Data</button>
                        <button class="service-button" onclick="showPulsaTransferForm()">Transfer Pulsa</button>
                        <button class="service-button" onclick="showTransferBankForm()">Transfer Bank</button>
                        <button class="service-button" onclick="showTransferEmoneyForm()">Transfer E-Money</button>
                        <button class="service-button" onclick="showTopupEmoneyForm()">Topup E-Money</button>
                        <button class="service-button" onclick="showPLNForm()">Token PLN</button>
                        <button class="service-button" onclick="showPDAMForm()">PDAM</button>
                        <button class="service-button" onclick="showBPJSForm()">BPJS</button>
                        <button class="service-button" onclick="showInternetForm()">Internet</button>
                        <button class="service-button" onclick="showTVForm()">TV Kabel</button>
                        <button class="service-button" onclick="showTelkomForm()">Telkom</button>
                        <button class="service-button" onclick="showGameForm()">Voucher Game</button>
                        <button class="service-button" onclick="showStreamingForm()">Voucher Streaming</button>
                        <button class="service-button" onclick="showAsuransiForm()">Asuransi</button>
                        <button class="service-button" onclick="showDonasiForm()">Donasi</button>
                    </div>
                `;
                
                await addMessageWithDelay("Semua layanan yang tersedia:");
                showMenuMessage(services);
            }, 500);
        }

        // Menu Pulsa
        function showPulsaMenu() {
            currentStep = 'service_menu';
            
            setTimeout(async () => {
                const services = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showPulsaForm()">Pulsa Reguler</button>
                        <button class="service-button" onclick="showDataForm()">Paket Data</button>
                        <button class="service-button" onclick="showPulsaTransferForm()">Transfer Pulsa</button>
                    </div>
                `;
                
                await addMessageWithDelay("Pilih layanan pulsa:");
                showMenuMessage(services);
            }, 500);
        }

        // Menu Transfer
        function showTransferMenu() {
            currentStep = 'service_menu';
            
            setTimeout(async () => {
                const services = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showTransferBankForm()">Transfer Bank</button>
                        <button class="service-button" onclick="showTransferEmoneyForm()">Transfer E-Money</button>
                        <button class="service-button" onclick="showTopupEmoneyForm()">Topup E-Money</button>
                    </div>
                `;
                
                await addMessageWithDelay("Pilih layanan transfer:");
                showMenuMessage(services);
            }, 500);
        }

        // Menu PPOB
        function showPPOBMenu() {
            currentStep = 'service_menu';
            
            setTimeout(async () => {
                const services = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showPLNForm()">Token PLN</button>
                        <button class="service-button" onclick="showPDAMForm()">PDAM</button>
                        <button class="service-button" onclick="showBPJSForm()">BPJS</button>
                        <button class="service-button" onclick="showInternetForm()">Internet</button>
                        <button class="service-button" onclick="showTVForm()">TV Kabel</button>
                        <button class="service-button" onclick="showTelkomForm()">Telkom</button>
                    </div>
                `;
                
                await addMessageWithDelay("Pilih layanan PPOB:");
                showMenuMessage(services);
            }, 500);
        }

        // Menu Lainnya
        function showLainnyaMenu() {
            currentStep = 'service_menu';
            
            setTimeout(async () => {
                const services = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showGameForm()">Voucher Game</button>
                        <button class="service-button" onclick="showStreamingForm()">Voucher Streaming</button>
                        <button class="service-button" onclick="showAsuransiForm()">Asuransi</button>
                        <button class="service-button" onclick="showDonasiForm()">Donasi</button>
                    </div>
                `;
                
                await addMessageWithDelay("Layanan lainnya:");
                showMenuMessage(services);
            }, 500);
        }

        // Form Pulsa Reguler
        function showPulsaForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Nomor HP Tujuan:</label>
                            <input type="tel" id="pulsa-nomor" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Nominal Pulsa:</label>
                            <select id="pulsa-nominal">
                                <option value="">Pilih Nominal</option>
                                <option value="5000">Rp 5.000</option>
                                <option value="10000">Rp 10.000</option>
                                <option value="20000">Rp 20.000</option>
                                <option value="25000">Rp 25.000</option>
                                <option value="50000">Rp 50.000</option>
                                <option value="100000">Rp 100.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="pulsa-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitPulsaForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form pulsa reguler:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Transfer Bank
        function showTransferBankForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Bank Tujuan:</label>
                            <select id="transfer-bank">
                                <option value="">Pilih Bank</option>
                                <option value="bca">BCA</option>
                                <option value="bni">BNI</option>
                                <option value="bri">BRI</option>
                                <option value="mandiri">Mandiri</option>
                                <option value="bsi">BSI</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nomor Rekening Tujuan:</label>
                            <input type="text" id="transfer-rek" placeholder="Nomor Rekening">
                        </div>
                        <div class="form-group">
                            <label>Jumlah Transfer:</label>
                            <input type="number" id="transfer-jumlah" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Nama Pengirim:</label>
                            <input type="text" id="transfer-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitTransferBankForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form transfer bank:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Token PLN
        function showPLNForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>ID Pelanggan:</label>
                            <input type="text" id="pln-id" placeholder="123456789012">
                        </div>
                        <div class="form-group">
                            <label>Nominal Token:</label>
                            <select id="pln-nominal">
                                <option value="">Pilih Nominal</option>
                                <option value="20000">Rp 20.000</option>
                                <option value="50000">Rp 50.000</option>
                                <option value="100000">Rp 100.000</option>
                                <option value="200000">Rp 200.000</option>
                                <option value="500000">Rp 500.000</option>
                                <option value="1000000">Rp 1.000.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="pln-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitPLNForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form token PLN:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Paket Data
        function showDataForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Nomor HP Tujuan:</label>
                            <input type="tel" id="data-nomor" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Operator:</label>
                            <select id="data-operator">
                                <option value="">Pilih Operator</option>
                                <option value="telkomsel">Telkomsel - Rp 50.000</option>
                                <option value="indosat">Indosat - Rp 45.000</option>
                                <option value="xl">XL - Rp 48.000</option>
                                <option value="tri">Tri - Rp 42.000</option>
                                <option value="axis">Axis - Rp 40.000</option>
                                <option value="smartfren">Smartfren - Rp 38.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="data-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitDataForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form paket ");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Transfer Pulsa
        function showPulsaTransferForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Nomor HP Pengirim:</label>
                            <input type="tel" id="transferpulsa-dari" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Nomor HP Tujuan:</label>
                            <input type="tel" id="transferpulsa-ke" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Nominal Transfer:</label>
                            <select id="transferpulsa-nominal">
                                <option value="">Pilih Nominal</option>
                                <option value="10000">Rp 10.000</option>
                                <option value="19500">Rp 20.000 (Harga: Rp 19.500)</option>
                                <option value="49000">Rp 50.000 (Harga: Rp 49.000)</option>
                                <option value="97500">Rp 100.000 (Harga: Rp 97.500)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pengirim:</label>
                            <input type="text" id="transferpulsa-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitPulsaTransferForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form transfer pulsa:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Transfer E-Money
        function showTransferEmoneyForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>E-Money:</label>
                            <select id="emoney-jenis">
                                <option value="">Pilih E-Money</option>
                                <option value="ovo">OVO</option>
                                <option value="gopay">GoPay</option>
                                <option value="dana">DANA</option>
                                <option value="linkaja">LinkAja</option>
                                <option value="shopeepay">ShopeePay</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nomor HP Tujuan:</label>
                            <input type="tel" id="emoney-nomor" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Jumlah Transfer:</label>
                            <input type="number" id="emoney-jumlah" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Nama Pengirim:</label>
                            <input type="text" id="emoney-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitTransferEmoneyForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form transfer e-money:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Topup E-Money
        function showTopupEmoneyForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>E-Money:</label>
                            <select id="topup-jenis">
                                <option value="">Pilih E-Money</option>
                                <option value="ovo">OVO</option>
                                <option value="gopay">GoPay</option>
                                <option value="dana">DANA</option>
                                <option value="linkaja">LinkAja</option>
                                <option value="shopeepay">ShopeePay</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nomor HP:</label>
                            <input type="tel" id="topup-nomor" placeholder="081234567890">
                        </div>
                        <div class="form-group">
                            <label>Nominal Topup:</label>
                            <select id="topup-nominal">
                                <option value="">Pilih Nominal</option>
                                <option value="10000">Rp 10.000</option>
                                <option value="20000">Rp 20.000</option>
                                <option value="50000">Rp 50.000</option>
                                <option value="100000">Rp 100.000</option>
                                <option value="200000">Rp 200.000</option>
                                <option value="500000">Rp 500.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="topup-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitTopupEmoneyForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form topup e-money:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form PDAM
        function showPDAMForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>ID Pelanggan:</label>
                            <input type="text" id="pdam-id" placeholder="ID Pelanggan">
                        </div>
                        <div class="form-group">
                            <label>Nama Wilayah:</label>
                            <input type="text" id="pdam-wilayah" placeholder="Nama Wilayah">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="pdam-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitPDAMForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form PDAM:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form BPJS
        function showBPJSForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>No. Kartu BPJS:</label>
                            <input type="text" id="bpjs-nomor" placeholder="No. Kartu BPJS">
                        </div>
                        <div class="form-group">
                            <label>Nama Peserta:</label>
                            <input type="text" id="bpjs-nama" placeholder="Nama Peserta">
                        </div>
                        <div class="form-group">
                            <label>Bulan Pembayaran:</label>
                            <select id="bpjs-bulan">
                                <option value="">Pilih Bulan</option>
                                <option value="januari">Januari - Rp 150.000</option>
                                <option value="februari">Februari - Rp 150.000</option>
                                <option value="maret">Maret - Rp 150.000</option>
                                <option value="april">April - Rp 150.000</option>
                                <option value="mei">Mei - Rp 150.000</option>
                                <option value="juni">Juni - Rp 150.000</option>
                                <option value="juli">Juli - Rp 150.000</option>
                                <option value="agustus">Agustus - Rp 150.000</option>
                                <option value="september">September - Rp 150.000</option>
                                <option value="oktober">Oktober - Rp 150.000</option>
                                <option value="november">November - Rp 150.000</option>
                                <option value="desember">Desember - Rp 150.000</option>
                            </select>
                        </div>
                        <button class="submit-form" onclick="submitBPJSForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form BPJS:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Internet
        function showInternetForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Provider Internet:</label>
                            <select id="internet-provider">
                                <option value="">Pilih Provider</option>
                                <option value="indihome">IndiHome - Rp 300.000</option>
                                <option value="myrepublic">MyRepublic - Rp 250.000</option>
                                <option value="biznet">Biznet - Rp 280.000</option>
                                <option value="firstmedia">FirstMedia - Rp 320.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>No. Pelanggan:</label>
                            <input type="text" id="internet-nomor" placeholder="No. Pelanggan">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="internet-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitInternetForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form internet:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form TV Kabel
        function showTVForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Provider TV:</label>
                            <select id="tv-provider">
                                <option value="">Pilih Provider</option>
                                <option value="indihome">IndiHome TV - Rp 200.000</option>
                                <option value="firstmedia">FirstMedia - Rp 250.000</option>
                                <option value="myrepublic">MyRepublic TV - Rp 180.000</option>
                                <option value="biznet">Biznet TV - Rp 220.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>No. Pelanggan:</label>
                            <input type="text" id="tv-nomor" placeholder="No. Pelanggan">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="tv-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitTVForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form TV kabel:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Telkom
        function showTelkomForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>No. Telepon:</label>
                            <input type="tel" id="telkom-nomor" placeholder="No. Telepon">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="telkom-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitTelkomForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form Telkom:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Voucher Game
        function showGameForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Jenis Game:</label>
                            <select id="game-jenis">
                                <option value="">Pilih Game</option>
                                <option value="mobile-legends">Mobile Legends - Rp 50.000</option>
                                <option value="free-fire">Free Fire - Rp 25.000</option>
                                <option value="pubg-mobile">PUBG Mobile - Rp 75.000</option>
                                <option value="genshin-impact">Genshin Impact - Rp 150.000</option>
                                <option value="valorant">Valorant - Rp 100.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ID Player:</label>
                            <input type="text" id="game-id" placeholder="ID Player">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="game-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitGameForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form voucher game:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Voucher Streaming
        function showStreamingForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Platform Streaming:</label>
                            <select id="streaming-platform">
                                <option value="">Pilih Platform</option>
                                <option value="netflix">Netflix - Rp 150.000</option>
                                <option value="spotify">Spotify - Rp 50.000</option>
                                <option value="youtube">YouTube Premium - Rp 100.000</option>
                                <option value="disney">Disney+ - Rp 120.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Email/ID:</label>
                            <input type="text" id="streaming-id" placeholder="Email atau ID">
                        </div>
                        <div class="form-group">
                            <label>Nama Pembeli:</label>
                            <input type="text" id="streaming-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitStreamingForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form voucher streaming:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Asuransi
        function showAsuransiForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Jenis Asuransi:</label>
                            <select id="asuransi-jenis">
                                <option value="">Pilih Asuransi</option>
                                <option value="jiwa">Asuransi Jiwa - Rp 500.000</option>
                                <option value="kesehatan">Asuransi Kesehatan - Rp 300.000</option>
                                <option value="kendaraan">Asuransi Kendaraan - Rp 750.000</option>
                                <option value="properti">Asuransi Properti - Rp 1.000.000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Pemilik:</label>
                            <input type="text" id="asuransi-nama" placeholder="Nama Lengkap">
                        </div>
                        <div class="form-group">
                            <label>Keterangan:</label>
                            <textarea id="asuransi-keterangan" placeholder="Keterangan tambahan" rows="3"></textarea>
                        </div>
                        <button class="submit-form" onclick="submitAsuransiForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form asuransi:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Form Donasi
        function showDonasiForm() {
            currentStep = 'form';
            
            setTimeout(async () => {
                const formHtml = `
                    <div class="form-container">
                        <div class="form-group">
                            <label>Tujuan Donasi:</label>
                            <input type="text" id="donasi-tujuan" placeholder="Tujuan Donasi">
                        </div>
                        <div class="form-group">
                            <label>Jumlah Donasi:</label>
                            <input type="number" id="donasi-jumlah" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Nama Donatur:</label>
                            <input type="text" id="donasi-nama" placeholder="Nama Lengkap">
                        </div>
                        <button class="submit-form" onclick="submitDonasiForm()">Tambah ke Keranjang</button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan isi form donasi:");
                showFormMessage(formHtml);
            }, 500);
        }

        // Fungsi umum untuk menampilkan form dengan jeda
        function showFormMessage(formHtml) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-with-avatar bot-message-with-avatar';
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="avatar bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message bot-message">
                        ${formHtml}
                        <div class="message-time">${formatTime(new Date())}</div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            playReceiveSound();
        }

        // Submit Form Pulsa
        function submitPulsaForm() {
            const nomor = document.getElementById('pulsa-nomor').value;
            const nominal = document.getElementById('pulsa-nominal').value;
            const nama = document.getElementById('pulsa-nama').value;
            
            if (!nomor || !nominal || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Pulsa Reguler',
                details: `Nomor: ${nomor}, Nominal: Rp ${nominal}`,
                price: parseInt(nominal)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Transfer Bank
        function submitTransferBankForm() {
            const bank = document.getElementById('transfer-bank').value;
            const rek = document.getElementById('transfer-rek').value;
            const jumlah = document.getElementById('transfer-jumlah').value;
            const nama = document.getElementById('transfer-nama').value;
            
            if (!bank || !rek || !jumlah || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Transfer Bank',
                details: `Bank: ${bank}, Rek: ${rek}, Jumlah: Rp ${jumlah}`,
                price: parseInt(jumlah)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Token PLN
        function submitPLNForm() {
            const idPelanggan = document.getElementById('pln-id').value;
            const nominal = document.getElementById('pln-nominal').value;
            const nama = document.getElementById('pln-nama').value;
            
            if (!idPelanggan || !nominal || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Token PLN',
                details: `ID: ${idPelanggan}, Nominal: Rp ${nominal}`,
                price: parseInt(nominal)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Paket Data
        function submitDataForm() {
            const nomor = document.getElementById('data-nomor').value;
            const operator = document.getElementById('data-operator').value;
            const nama = document.getElementById('data-nama').value;
            
            if (!nomor || !operator || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari operator
            const operatorText = operator.split(' - Rp ')[0];
            const priceText = operator.split(' - Rp ')[1];
            const price = parseInt(priceText) || 50000;
            
            const item = {
                service: 'Paket Data',
                details: `Nomor: ${nomor}, Operator: ${operatorText}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Transfer Pulsa
        function submitPulsaTransferForm() {
            const dari = document.getElementById('transferpulsa-dari').value;
            const ke = document.getElementById('transferpulsa-ke').value;
            const nominal = document.getElementById('transferpulsa-nominal').value;
            const nama = document.getElementById('transferpulsa-nama').value;
            
            if (!dari || !ke || !nominal || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil nominal asli dari text
            let displayNominal = "10.000";
            let price = 10000;
            
            if (nominal === "19500") {
                displayNominal = "20.000";
                price = 19500;
            } else if (nominal === "49000") {
                displayNominal = "50.000";
                price = 49000;
            } else if (nominal === "97500") {
                displayNominal = "100.000";
                price = 97500;
            }
            
            const item = {
                service: 'Transfer Pulsa',
                details: `Dari: ${dari}, Ke: ${ke}, Nominal: Rp ${displayNominal}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Transfer E-Money
        function submitTransferEmoneyForm() {
            const jenis = document.getElementById('emoney-jenis').value;
            const nomor = document.getElementById('emoney-nomor').value;
            const jumlah = document.getElementById('emoney-jumlah').value;
            const nama = document.getElementById('emoney-nama').value;
            
            if (!jenis || !nomor || !jumlah || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Transfer E-Money',
                details: `E-Money: ${jenis}, Nomor: ${nomor}, Jumlah: Rp ${jumlah}`,
                price: parseInt(jumlah)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Topup E-Money
        function submitTopupEmoneyForm() {
            const jenis = document.getElementById('topup-jenis').value;
            const nomor = document.getElementById('topup-nomor').value;
            const nominal = document.getElementById('topup-nominal').value;
            const nama = document.getElementById('topup-nama').value;
            
            if (!jenis || !nomor || !nominal || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Topup E-Money',
                details: `E-Money: ${jenis}, Nomor: ${nomor}, Nominal: Rp ${nominal}`,
                price: parseInt(nominal)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form PDAM
        function submitPDAMForm() {
            const id = document.getElementById('pdam-id').value;
            const wilayah = document.getElementById('pdam-wilayah').value;
            const nama = document.getElementById('pdam-nama').value;
            
            if (!id || !wilayah || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'PDAM',
                details: `ID: ${id}, Wilayah: ${wilayah}`,
                price: 100000 // Harga rata-rata PDAM
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form BPJS
        function submitBPJSForm() {
            const nomor = document.getElementById('bpjs-nomor').value;
            const nama = document.getElementById('bpjs-nama').value;
            const bulan = document.getElementById('bpjs-bulan').value;
            
            if (!nomor || !nama || !bulan) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari bulan
            const bulanText = bulan.split(' - Rp ')[0];
            const priceText = bulan.split(' - Rp ')[1];
            const price = parseInt(priceText) || 150000;
            
            const item = {
                service: 'BPJS',
                details: `No. Kartu: ${nomor}, Nama: ${nama}, Bulan: ${bulanText}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Internet
        function submitInternetForm() {
            const provider = document.getElementById('internet-provider').value;
            const nomor = document.getElementById('internet-nomor').value;
            const nama = document.getElementById('internet-nama').value;
            
            if (!provider || !nomor || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari provider
            const providerText = provider.split(' - Rp ')[0];
            const priceText = provider.split(' - Rp ')[1];
            const price = parseInt(priceText) || 300000;
            
            const item = {
                service: 'Internet',
                details: `Provider: ${providerText}, No. Pelanggan: ${nomor}, Nama: ${nama}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form TV Kabel
        function submitTVForm() {
            const provider = document.getElementById('tv-provider').value;
            const nomor = document.getElementById('tv-nomor').value;
            const nama = document.getElementById('tv-nama').value;
            
            if (!provider || !nomor || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari provider
            const providerText = provider.split(' - Rp ')[0];
            const priceText = provider.split(' - Rp ')[1];
            const price = parseInt(priceText) || 200000;
            
            const item = {
                service: 'TV Kabel',
                details: `Provider: ${providerText}, No. Pelanggan: ${nomor}, Nama: ${nama}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Telkom
        function submitTelkomForm() {
            const nomor = document.getElementById('telkom-nomor').value;
            const nama = document.getElementById('telkom-nama').value;
            
            if (!nomor || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Telkom',
                details: `No. Telepon: ${nomor}, Nama: ${nama}`,
                price: 150000 // Harga rata-rata telkom
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Voucher Game
        function submitGameForm() {
            const jenis = document.getElementById('game-jenis').value;
            const id = document.getElementById('game-id').value;
            const nama = document.getElementById('game-nama').value;
            
            if (!jenis || !id || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari jenis game
            const jenisText = jenis.split(' - Rp ')[0];
            const priceText = jenis.split(' - Rp ')[1];
            const price = parseInt(priceText) || 50000;
            
            const item = {
                service: 'Voucher Game',
                details: `Game: ${jenisText}, ID Player: ${id}, Nama: ${nama}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Voucher Streaming
        function submitStreamingForm() {
            const platform = document.getElementById('streaming-platform').value;
            const id = document.getElementById('streaming-id').value;
            const nama = document.getElementById('streaming-nama').value;
            
            if (!platform || !id || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari platform
            const platformText = platform.split(' - Rp ')[0];
            const priceText = platform.split(' - Rp ')[1];
            const price = parseInt(priceText) || 100000;
            
            const item = {
                service: 'Voucher Streaming',
                details: `Platform: ${platformText}, ID: ${id}, Nama: ${nama}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Asuransi
        function submitAsuransiForm() {
            const jenis = document.getElementById('asuransi-jenis').value;
            const nama = document.getElementById('asuransi-nama').value;
            const keterangan = document.getElementById('asuransi-keterangan').value;
            
            if (!jenis || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Ambil harga dari jenis asuransi
            const jenisText = jenis.split(' - Rp ')[0];
            const priceText = jenis.split(' - Rp ')[1];
            const price = parseInt(priceText) || 500000;
            
            const item = {
                service: 'Asuransi',
                details: `Jenis: ${jenisText}, Nama: ${nama}, Keterangan: ${keterangan || '-'}`,
                price: price
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Submit Form Donasi
        function submitDonasiForm() {
            const tujuan = document.getElementById('donasi-tujuan').value;
            const jumlah = document.getElementById('donasi-jumlah').value;
            const nama = document.getElementById('donasi-nama').value;
            
            if (!tujuan || !jumlah || !nama) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            const item = {
                service: 'Donasi',
                details: `Tujuan: ${tujuan}, Nama: ${nama}`,
                price: parseInt(jumlah)
            };
            
            cart.push(item);
            showCartConfirmation();
        }

        // Tampilkan konfirmasi keranjang dengan jeda
        function showCartConfirmation() {
            currentStep = 'checkout';
            
            setTimeout(async () => {
                let cartMessage = "Item telah ditambahkan ke keranjang:\n\n";
                cart.forEach((item, index) => {
                    cartMessage += `${index + 1}. ${item.service}\n   ${item.details}\n   Harga: Rp ${item.price.toLocaleString('id-ID')}\n\n`;
                });
                
                cartMessage += "Apakah Anda ingin memesan layanan lain atau lanjut ke pembayaran?";
                
                const buttons = `
                    <div class="service-buttons">
                        <button class="service-button" onclick="showMainMenu()">Pesan Lagi</button>
                        <button class="service-button" onclick="showRating()">Lanjut ke Pembayaran</button>
                    </div>
                `;
                
                await addMessageWithDelay(cartMessage);
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-with-avatar bot-message-with-avatar';
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="avatar bot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message bot-message">
                            ${buttons}
                            <div class="message-time">${formatTime(new Date())}</div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                playReceiveSound();
            }, 500);
        }

        // Tampilkan rating dengan jeda
        function showRating() {
            currentStep = 'rating';
            
            setTimeout(async () => {
                const ratingHtml = `
                    <div class="rating-container">
                        <div>Bagaimana pengalaman Anda dengan layanan kami?</div>
                        <div class="rating-stars" id="rating-stars">
                            <span class="star" onclick="setRating(1)">★</span>
                            <span class="star" onclick="setRating(2)">★</span>
                            <span class="star" onclick="setRating(3)">★</span>
                            <span class="star" onclick="setRating(4)">★</span>
                            <span class="star" onclick="setRating(5)">★</span>
                        </div>
                        <button class="payment-button" onclick="showPayment()" id="payment-button" style="display:none;">
                            Lanjut ke Pembayaran
                        </button>
                    </div>
                `;
                
                await addMessageWithDelay("Silakan berikan penilaian Anda:");
                showMenuMessage(ratingHtml);
            }, 500);
        }

        // Set rating
        function setRating(rating) {
            // Aktifkan bintang sesuai rating
            const stars = document.querySelectorAll('#rating-stars .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            // Tampilkan tombol pembayaran
            document.getElementById('payment-button').style.display = 'block';
        }

        // Tampilkan pembayaran dengan jeda
        function showPayment() {
            currentStep = 'payment';
            
            setTimeout(async () => {
                let total = 0;
                cart.forEach(item => {
                    total += item.price;
                });
                
                const ppn = total * 0.12;
                const grandTotal = total + ppn;
                
                const paymentMessage = `
                    <strong>RINCIAN PEMBAYARAN</strong>
                    <br><br>
                    ${cart.map((item, index) => 
                        `${index + 1}. ${item.service}<br>
                         &nbsp;&nbsp;&nbsp;${item.details}<br>
                         &nbsp;&nbsp;&nbsp;Rp ${item.price.toLocaleString('id-ID')}`
                    ).join('<br><br>')}
                    <br><br>
                    Sub Total: Rp ${total.toLocaleString('id-ID')}<br>
                    PPN (12%): Rp ${ppn.toLocaleString('id-ID')}<br>
                    <strong>Grand Total: Rp ${grandTotal.toLocaleString('id-ID')}</strong>
                    <br><br>
                    Silakan lakukan pembayaran dan konfirmasi ke WhatsApp kami.
                `;
                
                const paymentButton = `
                    <button class="payment-button" onclick="sendToWhatsApp()">
                        <i class="fab fa-whatsapp"></i> Kirim ke WhatsApp
                    </button>
                `;
                
                await addMessageWithDelay("Berikut rincian pembayaran Anda:");
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-with-avatar bot-message-with-avatar';
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="avatar bot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message bot-message">
                            <div>${paymentMessage}</div>
                            ${paymentButton}
                            <div class="message-time">${formatTime(new Date())}</div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                playReceiveSound();
            }, 500);
        }

        // Fungsi untuk mengirim pesan ke WhatsApp
        function sendToWhatsApp() {
            let total = 0;
            cart.forEach(item => {
                total += item.price;
            });
            
            const ppn = total * 0.12;
            const grandTotal = total + ppn;
            
            let message = `*PESANAN Bot Payment*\n\n`;
            message += `No. WhatsApp: ${userPhoneNumber}\n\n`;
            
            cart.forEach((item, index) => {
                message += `${index + 1}. ${item.service}\n`;
                message += `   ${item.details}\n`;
                message += `   Harga: Rp ${item.price.toLocaleString('id-ID')}\n\n`;
            });
            
            message += `Sub Total: Rp ${total.toLocaleString('id-ID')}\n`;
            message += `PPN (12%): Rp ${ppn.toLocaleString('id-ID')}\n`;
            message += `*Grand Total: Rp ${grandTotal.toLocaleString('id-ID')}*\n\n`;
            message += `Silakan lakukan pembayaran dan konfirmasi pembayaran Anda.`;
            
            const whatsappUrl = `https://wa.me/0816308466?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // Reset keranjang dan kembali ke menu utama
            setTimeout(() => {
                cart = [];
                showMainMenu();
                addMessage("Pesanan Anda telah dikirim ke WhatsApp. Terima kasih telah menggunakan layanan kami!", false);
            }, 2000);
        }

        // Database pertanyaan dan jawaban
        const qaDatabase = {
            "halo": "Halo! Selamat datang di Bot Payment. Saya siap membantu Anda.",
            "hai": "Hai! Ada yang bisa saya bantu?",
            "apa kabar": "Saya baik, terima kasih! Bagaimana dengan Anda?",
            "siapa kamu": "Saya adalah chatbot Bot Payment yang siap membantu Anda dengan berbagai layanan digital.",
            "terima kasih": "Sama-sama! Jangan ragu untuk memesan layanan kami.",
            "sampai jumpa": "Sampai jumpa! Terima kasih telah menggunakan layanan kami.",
            "hello": "Hello! How can I help you today?",
            "help": "Saya bisa membantu Anda dengan berbagai layanan. Silakan ketik nama layanan yang Anda butuhkan.",
            "pulsa": "Kami menyediakan layanan pulsa reguler, paket data, dan transfer pulsa.",
            "transfer": "Kami menyediakan layanan transfer bank, transfer e-money, dan topup e-money.",
            "ppob": "Kami menyediakan layanan pembayaran PPOB seperti token PLN, PDAM, BPJS, internet, TV kabel, dan telkom.",
            "lainnya": "Kami juga menyediakan layanan voucher game, voucher streaming, asuransi, dan donasi.",
            "menu": "Silakan pilih kategori layanan yang tersedia: Pulsa, Transfer, PPOB, atau Lainnya.",
            "pulsa reguler": "Silakan isi form pulsa reguler berikut:",
            "paket data": "Silakan isi form paket data berikut:",
            "transfer pulsa": "Silakan isi form transfer pulsa berikut:",
            "transfer bank": "Silakan isi form transfer bank berikut:",
            "transfer e-money": "Silakan isi form transfer e-money berikut:",
            "topup e-money": "Silakan isi form topup e-money berikut:",
            "token pln": "Silakan isi form token PLN berikut:",
            "pdam": "Silakan isi form PDAM berikut:",
            "bpjs": "Silakan isi form BPJS berikut:",
            "internet": "Silakan isi form internet berikut:",
            "tv kabel": "Silakan isi form TV kabel berikut:",
            "telkom": "Silakan isi form Telkom berikut:",
            "voucher game": "Silakan isi form voucher game berikut:",
            "voucher streaming": "Silakan isi form voucher streaming berikut:",
            "asuransi": "Silakan isi form asuransi berikut:",
            "donasi": "Silakan isi form donasi berikut:"
        };

        // Fungsi untuk menangani pesan teks
        function handleTextMessage(message) {
            const lowerMessage = message.toLowerCase().trim();
            
            // Cek apakah ada jawaban yang sesuai di database
            for (const [key, value] of Object.entries(qaDatabase)) {
                if (lowerMessage.includes(key)) {
                    return value;
                }
            }

            // Jika tidak ada jawaban yang sesuai, arahkan ke menu
            return "Maaf, saya belum memahami pertanyaan tersebut. Berikut layanan yang tersedia:";
        }

        // Fungsi untuk mengirim pesan
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Tambahkan pesan user dan mainkan suara
            addMessage(message, true);
            playSendSound();
            
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Proses berdasarkan step saat ini
            if (currentStep === 'ask_phone') {
                // Validasi nomor WhatsApp
                if (isValidPhoneNumber(message)) {
                    userPhoneNumber = message;
                    setTimeout(() => {
                        addMessageWithDelay("Terima kasih! Nomor WhatsApp Anda telah terdaftar.").then(() => {
                            showMainMenu();
                        });
                    }, 500);
                } else {
                    setTimeout(() => {
                        addMessageWithDelay("Mohon masukkan nomor WhatsApp yang valid (contoh: 081234567890)");
                    }, 500);
                }
                return;
            }

            // Untuk step lainnya, tangani pesan teks
            if (currentStep !== 'form') {
                setTimeout(() => {
                    // Generate response
                    const responseText = handleTextMessage(message);
                    addMessageWithDelay(responseText).then(() => {
                        // Cek apakah user mengetik nama layanan tertentu
                        const lowerMessage = message.toLowerCase().trim();
                        
                        // Handle layanan pulsa
                        if (lowerMessage.includes('pulsa reguler')) {
                            setTimeout(() => showPulsaForm(), 500);
                        } else if (lowerMessage.includes('paket data')) {
                            setTimeout(() => showDataForm(), 500);
                        } else if (lowerMessage.includes('transfer pulsa')) {
                            setTimeout(() => showPulsaTransferForm(), 500);
                        } 
                        // Handle layanan transfer
                        else if (lowerMessage.includes('transfer bank')) {
                            setTimeout(() => showTransferBankForm(), 500);
                        } else if (lowerMessage.includes('transfer e-money')) {
                            setTimeout(() => showTransferEmoneyForm(), 500);
                        } else if (lowerMessage.includes('topup e-money')) {
                            setTimeout(() => showTopupEmoneyForm(), 500);
                        }
                        // Handle layanan PPOB
                        else if (lowerMessage.includes('token pln')) {
                            setTimeout(() => showPLNForm(), 500);
                        } else if (lowerMessage.includes('pdam')) {
                            setTimeout(() => showPDAMForm(), 500);
                        } else if (lowerMessage.includes('bpjs')) {
                            setTimeout(() => showBPJSForm(), 500);
                        } else if (lowerMessage.includes('internet')) {
                            setTimeout(() => showInternetForm(), 500);
                        } else if (lowerMessage.includes('tv kabel')) {
                            setTimeout(() => showTVForm(), 500);
                        } else if (lowerMessage.includes('telkom')) {
                            setTimeout(() => showTelkomForm(), 500);
                        }
                        // Handle layanan lainnya
                        else if (lowerMessage.includes('voucher game')) {
                            setTimeout(() => showGameForm(), 500);
                        } else if (lowerMessage.includes('voucher streaming')) {
                            setTimeout(() => showStreamingForm(), 500);
                        } else if (lowerMessage.includes('asuransi')) {
                            setTimeout(() => showAsuransiForm(), 500);
                        } else if (lowerMessage.includes('donasi')) {
                            setTimeout(() => showDonasiForm(), 500);
                        }
                        // Handle kategori utama
                        else if (lowerMessage.includes('pulsa') && !lowerMessage.includes('reguler') && !lowerMessage.includes('transfer') && !lowerMessage.includes('data')) {
                            setTimeout(() => showPulsaMenu(), 500);
                        } else if (lowerMessage.includes('transfer') && !lowerMessage.includes('bank') && !lowerMessage.includes('e-money')) {
                            setTimeout(() => showTransferMenu(), 500);
                        } else if (lowerMessage.includes('ppob') && !lowerMessage.includes('pln') && !lowerMessage.includes('pdam') && !lowerMessage.includes('bpjs') && !lowerMessage.includes('internet') && !lowerMessage.includes('tv') && !lowerMessage.includes('telkom')) {
                            setTimeout(() => showPPOBMenu(), 500);
                        } else if (lowerMessage.includes('lainnya')) {
                            setTimeout(() => showLainnyaMenu(), 500);
                        }
                        // Jika tidak ada jawaban yang cocok, tampilkan menu
                        else {
                            const found = Object.keys(qaDatabase).some(key => lowerMessage.includes(key));
                            if (!found && currentStep === 'main_menu') {
                                setTimeout(showMainMenu, 500);
                            }
                        }
                    });
                }, 500);
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Focus input saat halaman dimuat
        messageInput.focus();
    </script>
</body>
    </html>
